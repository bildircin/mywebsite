

<link href="assets/plugins/custom/datatables/datatables.bundle.css" rel="stylesheet" type="text/css" />
<link href="assets/plugins/custom/prismjs/prismjs.bundle.css" rel="stylesheet" type="text/css" />

    <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
        <div id="kt_app_toolbar_container" class="app-container container-fluid d-flex flex-stack">
            <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
                <h1 class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">Dil Değerleri Güncelleme</h1>
                <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
                    <li class="breadcrumb-item text-muted">
                        <a href="/admin" class="text-muted text-hover-primary">Anasayfa</a>
                    </li>
                    <li class="breadcrumb-item">
                        <span class="bullet bg-gray-400 w-5px h-2px"></span>
                    </li>
                    <li class="breadcrumb-item text-muted">Dil Ayarları</li>
                    <li class="breadcrumb-item">
                        <span class="bullet bg-gray-400 w-5px h-2px"></span>
                    </li>
                    <li class="breadcrumb-item text-muted">Dil Değerleri Güncelleme</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="kt_app_content" class="app-content flex-column-fluid">
        <div id="kt_app_content_container" class="app-container container-fluid">
            <div class="card card-docs flex-row-fluid mb-2">
                <div class="card-body fs-6 py-15 px-10 py-lg-15 px-lg-15 text-gray-700">
                    
                    <div class="mb-10">
                        <label class="form-label" for="language_select">Dil</label>
                        <select class="form-select form-select-solid" data-placeholder="Seçim Yapınız" id="language_select">
                            <option></option>
                            <% languageCodes.forEach(item =>{ %>
                                <option value="<%= item.lng %>" data-kt-select2-country="webUI/image/flags/<%= item.lng %>.svg"><%= item.name %></option>
                            <% }) %>
                        </select>
                    </div>

                    <table class="table table-row-bordered gy-5 gs-7 border rounded mb-10" id="item_list">
                        <thead>
                            <tr class="fw-bold fs-6 text-gray-800 px-7">
                                <th>Anahtar</th>
                                <th>Değer</th>
                            </tr>
                        </thead>
                        <tbody id="language_result_list">
 
                            
                        </tbody>
                    </table>
                    <div class="d-flex justify-content-end">
                        <button id="save_btn" class="btn btn-success">Kaydet</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/plugins/custom/datatables/datatables.bundle.js"></script>
    <script src="assets/plugins/custom/prismjs/prismjs.bundle.js"></script>
    
<script>
    $(document).ready(function(){

        // Format options
        var optionFormat = function(item) {
            if ( !item.id ) {
                return item.text;
            }

            var span = document.createElement('span');
            var imgUrl = item.element.getAttribute('data-kt-select2-country');
            var template = '';

            template += '<img src="' + imgUrl + '" class="rounded-circle h-20px me-2" alt="image"/>';
            template += item.text;

            span.innerHTML = template;

            return $(span);
        }

        $('#language_select').select2({
            templateSelection: optionFormat,
            templateResult: optionFormat
        });


        $('#language_select').on('select2:select', function(){
            const lng = $(this).val()
            console.log(lng)
            $.post("/createOrUpdateLanguageItemAjax", {lng}, function(result) {
                
                $('#language_result_list').empty()

                let list = result.languageItems

                list.forEach(item => {
                    
                    let tr = `<tr class="lang-item" data-key="${item.key}">
                                <td>
                                    ${item.key}
                                    <i class="fas fa-exclamation-circle ms-2 fs-7" data-bs-toggle="tooltip" title="${item.title}"></i>
                                </td>
                                <td>
                                    <input type="text" class="form-control form-control-solid" value="${item.value}" />
                                </td>
                            </tr>`
                    $('#language_result_list').append(tr)
                });

                $('#item_list').DataTable()

                const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
                const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
            })
            .fail(function(err) {
                console.log(err)
            })
        })

    })

    $('#save_btn').on('click', function(){
        let updateList = {}
        let lng = $('#language_select').val()
        let domList = $('#language_result_list > tr')

        for (let i = 0; i < domList.length; i++) {
            const item = $(domList[i])
            updateList[item.data('key')] = item.find('input').val()
        }

        $.post("/createOrUpdateLanguageItemSaveAjax", {updateList, lng}, function(result) {
            if (result.isSuccess) {
                toastr.success(result.message)
            }else{
                toastr.error(result.message)
            }
        })
        .fail(function(err) {
            toastr.error(err)
        })
    })

</script>